<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.finalproject.infrastructure.mybatis.mapper.SeatsMapper">
    <insert id="insert" parameterType="java.util.List">
        insert into seats (id, number, rows_alphabet, room_id) values
        <foreach collection="seats" item="seat" index="index" open="(" separator="),("  close=")">
            #{seat.id},
            #{seat.number},
            #{seat.rows_alphabet},
            #{seat.room_id}
        </foreach>
    </insert>

    <select id="getSeats" resultMap="seatData">
        select id, number, rows_alphabet from seats where room_id = #{roomId}
    </select>

    <select id="getSeatRow" resultMap="seatRowData">
        select rows_alphabet from seats where room_id = #{roomId} group by rows_alphabet order by rows_alphabet asc;
    </select>

    <select id="getSeatsPremiere" resultMap="seatOccupied">
        SELECT seat_id, premiere_id, status
        FROM seat_occupied AS so
        WHERE so.premiere_id = #{premiereId}
    </select>

    <insert id="insertSeatOccupied" parameterType="java.util.List">
        INSERT INTO seat_occupied (seat_id, premiere_id, status) VALUES
        <foreach collection="seatOccupiedList" item="seatOccupied" index="index" open="(" separator="),("  close=")">
            #{seatOccupied.seat_id},
            #{seatOccupied.premiere_id},
            #{seatOccupied.status}
        </foreach>
    </insert>

    <select id="existsSeatOccupied" resultType="java.lang.Boolean">
        SELECT EXISTS(SELECT status FROM seat_occupied WHERE seat_id = #{seatId} AND premiere_id = #{premiereId})
    </select>

    <resultMap id="seatData" type="com.example.finalproject.application.seats.SeatData" >
        <id column="id" property="id"/>
        <result column="number" property="number"/>
        <result column="rows_alphabet" property="rows_alphabet"/>
    </resultMap>

    <resultMap id="seatRowData" type="com.example.finalproject.application.seats.SeatRow" >
        <result column="rows_alphabet" property="rows_alphabet"/>
    </resultMap>

    <resultMap id="seatOccupied" type="com.example.finalproject.core.seats.SeatOccupied" autoMapping="true">
        <result column="seat_id" property="seat_id"/>
        <result column="premiere_id" property="premiere_id"/>
    </resultMap>
</mapper>